{% comment %} sections/product-grid-paginate.liquid {% endcomment %}
{% liquid
  assign coll = section.settings.collection | default: collection
  assign per_page = section.settings.products_per_page | default: 12
%}

<section class="products products--grid" role="region" aria-label="{{ section.settings.aria_label | default: 'Product grid' | escape }}">
  <div class="container products__inner">
    {% if coll == blank %}
      <p class="products__empty">Select a collection in the section settings.</p>
    {% else %}
      {% paginate coll.products by per_page %}
        {% if paginate.items_count == 0 %}
          <p class="products__empty">No products found.</p>
        {% else %}
          <ul class="products__grid" role="list">
            {% for product in paginate.items %}
              <li class="products__item" role="listitem">
                <article class="product-card">
                  <a class="product-card__media" href="{{ product.url }}" aria-label="{{ product.title | escape }}">
                    {% if product.featured_image %}
                      <img
                        src="{{ product.featured_image | image_url: width: 600 }}"
                        srcset="{{ product.featured_image | image_url: width: 300 }} 300w, {{ product.featured_image | image_url: width: 600 }} 600w, {{ product.featured_image | image_url: width: 900 }} 900w"
                        sizes="(min-width: 990px) 300px, 50vw"
                        alt="{{ product.featured_image.alt | default: product.title | escape }}"
                        loading="lazy"
                        width="600"
                      >
                    {% endif %}
                  </a>
                  <div class="product-card__info">
                    <h3 class="product-card__title"><a href="{{ product.url }}">{{ product.title | escape }}</a></h3>
                    {% if section.settings.show_vendor and product.vendor %}
                      <div class="product-card__vendor">{{ product.vendor | escape }}</div>
                    {% endif %}
                    <div class="product-card__price">
                      {% liquid
                        assign price = product.price
                        assign compare = product.compare_at_price_max
                      %}
                      <span class="price">{{ price | money }}</span>
                      {% if section.settings.show_compare_at and compare > price %}
                        <span class="price price--compare">{{ compare | money }}</span>
                      {% endif %}
                    </div>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ul>

          {% if paginate.pages > 1 %}
            <nav class="pagination" role="navigation" aria-label="Product pagination">
              <ul class="pagination__list" role="list">
                <li>
                  {% if paginate.previous %}
                    <a class="pagination__prev" href="{{ paginate.previous.url }}" aria-label="Previous page">&laquo;</a>
                  {% else %}
                    <span class="pagination__prev pagination__prev--disabled" aria-disabled="true">&laquo;</span>
                  {% endif %}
                </li>
                {% for part in paginate.parts %}
                  <li>
                    {% if part.is_link %}
                      <a class="pagination__link" href="{{ part.url }}" aria-label="Go to page {{ part.title }}">{{ part.title }}</a>
                    {% else %}
                      <span class="pagination__link{% if part.title == paginate.current_page %} is-active{% endif %}" aria-current="{% if part.title == paginate.current_page %}page{% else %}false{% endif %}">{{ part.title }}</span>
                    {% endif %}
                  </li>
                {% endfor %}
                <li>
                  {% if paginate.next %}
                    <a class="pagination__next" href="{{ paginate.next.url }}" aria-label="Next page">&raquo;</a>
                  {% else %}
                    <span class="pagination__next pagination__next--disabled" aria-disabled="true">&raquo;</span>
                  {% endif %}
                </li>
              </ul>
            </nav>
          {% endif %}
        {% endif %}
      {% endpaginate %}
    {% endif %}
  </div>
</section>

{% schema %}{
  "name": "Product grid (paginate)",
  "settings": [
    {"type": "collection", "id": "collection", "label": "Collection"},
    {"type": "range", "id": "products_per_page", "label": "Products per page", "min": 4, "max": 48, "step": 4, "default": 12},
    {"type": "checkbox", "id": "show_vendor", "label": "Show vendor"},
    {"type": "checkbox", "id": "show_compare_at", "label": "Show compare-at price"},
    {"type": "text", "id": "aria_label", "label": "Section aria-label (optional)"}
  ],
  "presets": [
    {"name": "Product grid (paginate)"}
  ]
}{% endschema %}

