{% comment %} sections/faq-accordion.liquid {% endcomment %}
<section class="faq-section-{{ section.id }}" role="region" aria-labelledby="faq-heading-{{ section.id }}">
  <div class="faq-container">
    {% if section.settings.title != blank %}
      <h2 id="faq-heading-{{ section.id }}" class="faq-title">{{ section.settings.title | escape }}</h2>
    {% endif %}

    {% if section.settings.description != blank %}
      <div class="faq-description">{{ section.settings.description }}</div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="faq-list">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'faq_item' %}
              <div class="faq-item" {{ block.shopify_attributes }}>
                <button class="faq-question"
                        type="button"
                        aria-expanded="false"
                        aria-controls="faq-answer-{{ block.id }}"
                        data-faq-toggle>
                  {{ block.settings.question | escape }}
                  <span class="faq-icon" aria-hidden="true"></span>
                </button>
                <div class="faq-answer" id="faq-answer-{{ block.id }}" data-faq-answer>
                  <div class="faq-answer-content">
                    {{ block.settings.answer }}
                  </div>
                </div>
              </div>
          {% endcase %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>

<style>
  .faq-section-{{ section.id }} {
    padding: {{ section.settings.padding_top }}px 20px {{ section.settings.padding_bottom }}px;
    background: {{ section.settings.bg_color | default: '#ffffff' }};
  }

  .faq-container {
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
  }

  .faq-title {
    text-align: {{ section.settings.title_alignment }};
    font-size: {{ section.settings.title_size }}px;
    color: {{ section.settings.title_color | default: '#333333' }};
    margin: 0 0 {{ section.settings.title_margin }}px 0;
    line-height: 1.2;
  }

  .faq-description {
    text-align: {{ section.settings.title_alignment }};
    font-size: {{ section.settings.description_size }}px;
    color: {{ section.settings.text_color | default: '#666666' }};
    margin: 0 0 {{ section.settings.description_margin }}px 0;
    line-height: 1.5;
  }

  .faq-list {
    display: flex;
    flex-direction: column;
    gap: {{ section.settings.item_spacing }}px;
  }

  .faq-item {
    border: {{ section.settings.border_width }}px solid {{ section.settings.border_color | default: '#e5e5e5' }};
    border-radius: {{ section.settings.border_radius }}px;
    overflow: hidden;
    background: {{ section.settings.item_bg_color | default: '#ffffff' }};
  }

  .faq-question {
    width: 100%;
    background: none;
    border: none;
    padding: {{ section.settings.question_padding }}px;
    text-align: left;
    font-size: {{ section.settings.question_size }}px;
    font-weight: {{ section.settings.question_weight }};
    color: {{ section.settings.question_color | default: '#333333' }};
    cursor: pointer;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.3s ease, color 0.3s ease;
    line-height: 1.4;
  }

  .faq-question:hover {
    background: {{ section.settings.question_hover_bg | default: '#f8f9fa' }};
    color: {{ section.settings.question_hover_color | default: '#007cba' }};
  }

  .faq-question:focus {
    outline: 2px solid {{ section.settings.accent_color | default: '#007cba' }};
    outline-offset: 2px;
  }

  .faq-icon {
    font-size: {{ section.settings.icon_size }}px;
    color: {{ section.settings.icon_color | default: '#666666' }};
    transition: transform 0.3s ease, color 0.3s ease;
    flex-shrink: 0;
    margin-left: 16px;
  }

  .faq-icon::before {
    content: '{{ section.settings.icon_closed | default: "+" }}';
  }

  .faq-question[aria-expanded="true"] .faq-icon {
    transform: rotate({{ section.settings.icon_rotation }}deg);
    color: {{ section.settings.icon_active_color | default: '#007cba' }};
  }

  .faq-question[aria-expanded="true"] .faq-icon::before {
    content: '{{ section.settings.icon_open | default: "âˆ’" }}';
  }

  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
    background: {{ section.settings.answer_bg_color | default: '#ffffff' }};
  }

  .faq-answer.open {
    max-height: 1000px;
    padding: 0 {{ section.settings.question_padding }}px {{ section.settings.answer_padding }}px;
  }

  .faq-answer-content {
    color: {{ section.settings.answer_color | default: '#666666' }};
    font-size: {{ section.settings.answer_size }}px;
    line-height: 1.6;
  }

  .faq-answer-content p {
    margin: 0 0 16px 0;
  }

  .faq-answer-content p:last-child {
    margin-bottom: 0;
  }

  .faq-answer-content ul,
  .faq-answer-content ol {
    margin: 0 0 16px 0;
    padding-left: 24px;
  }

  .faq-answer-content li {
    margin-bottom: 8px;
  }

  @media (max-width: 768px) {
    .faq-section-{{ section.id }} {
      padding: {{ section.settings.padding_top_mobile }}px 16px {{ section.settings.padding_bottom_mobile }}px;
    }

    .faq-container {
      max-width: 100%;
    }

    .faq-title {
      font-size: {{ section.settings.title_size_mobile }}px;
    }

    .faq-description {
      font-size: {{ section.settings.description_size_mobile }}px;
    }

    .faq-question {
      padding: {{ section.settings.question_padding_mobile }}px;
      font-size: {{ section.settings.question_size_mobile }}px;
    }

    .faq-answer.open {
      padding: 0 {{ section.settings.question_padding_mobile }}px {{ section.settings.answer_padding_mobile }}px;
    }

    .faq-answer-content {
      font-size: {{ section.settings.answer_size_mobile }}px;
    }

    .faq-icon {
      font-size: {{ section.settings.icon_size_mobile }}px;
      margin-left: 12px;
    }
  }
</style>

{% schema %}
{
  "name": "FAQ Accordion",
  "tag": "section",
  "class": "faq-section",
  "max_blocks": 20,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Find answers to the most common questions about our products and services.</p>"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "container_width",
      "label": "Container Width",
      "min": 600,
      "max": 1400,
      "step": 50,
      "unit": "px",
      "default": 800
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {"value": "left", "label": "Left"},
        {"value": "center", "label": "Center"},
        {"value": "right", "label": "Right"}
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "item_spacing",
      "label": "Spacing Between Items",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 200,
      "step": 10,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "title_margin",
      "label": "Title Bottom Margin",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "description_margin",
      "label": "Description Bottom Margin",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "question_padding",
      "label": "Question Padding",
      "min": 12,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "answer_padding",
      "label": "Answer Bottom Padding",
      "min": 12,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Section Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Description Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "item_bg_color",
      "label": "FAQ Item Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "question_color",
      "label": "Question Text Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "question_hover_bg",
      "label": "Question Hover Background",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "question_hover_color",
      "label": "Question Hover Color",
      "default": "#007cba"
    },
    {
      "type": "color",
      "id": "answer_bg_color",
      "label": "Answer Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "answer_color",
      "label": "Answer Text Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#007cba"
    },
    {
      "type": "header",
      "content": "Border"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border Width",
      "min": 0,
      "max": 5,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#e5e5e5"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title Size",
      "min": 24,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "description_size",
      "label": "Description Size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "question_size",
      "label": "Question Size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "select",
      "id": "question_weight",
      "label": "Question Font Weight",
      "options": [
        {"value": "400", "label": "Normal"},
        {"value": "500", "label": "Medium"},
        {"value": "600", "label": "Semi Bold"},
        {"value": "700", "label": "Bold"}
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "answer_size",
      "label": "Answer Size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Icon Settings"
    },
    {
      "type": "text",
      "id": "icon_closed",
      "label": "Closed Icon",
      "default": "+",
      "info": "Character or symbol for closed state"
    },
    {
      "type": "text",
      "id": "icon_open",
      "label": "Open Icon",
      "default": "âˆ’",
      "info": "Character or symbol for open state"
    },
    {
      "type": "range",
      "id": "icon_size",
      "label": "Icon Size",
      "min": 14,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "icon_rotation",
      "label": "Icon Rotation (degrees)",
      "min": 0,
      "max": 360,
      "step": 45,
      "unit": "deg",
      "default": 0
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "icon_active_color",
      "label": "Active Icon Color",
      "default": "#007cba"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Mobile Top Padding",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Mobile Bottom Padding",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Mobile Title Size",
      "min": 20,
      "max": 36,
      "step": 2,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "description_size_mobile",
      "label": "Mobile Description Size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "question_size_mobile",
      "label": "Mobile Question Size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "answer_size_mobile",
      "label": "Mobile Answer Size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "question_padding_mobile",
      "label": "Mobile Question Padding",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "answer_padding_mobile",
      "label": "Mobile Answer Padding",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "icon_size_mobile",
      "label": "Mobile Icon Size",
      "min": 12,
      "max": 24,
      "step": 2,
      "unit": "px",
      "default": 16
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>We offer a 30-day return policy on all items. Items must be in original condition with tags attached.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Accordion",
      "category": "Text",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "<p>Standard shipping takes 3-5 business days. Express shipping is available for 1-2 day delivery.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We offer a 30-day return policy on all items. Items must be in original condition with tags attached.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Do you ship internationally?",
            "answer": "<p>Yes, we ship to most countries worldwide. International shipping rates apply and delivery times may vary.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  initFAQAccordion{{ section.id | replace: '-', '' }}();
});

document.addEventListener('shopify:section:load', function(event) {
  if (event.detail.sectionId === '{{ section.id }}') {
    initFAQAccordion{{ section.id | replace: '-', '' }}();
  }
});

function initFAQAccordion{{ section.id | replace: '-', '' }}() {
  const toggles = document.querySelectorAll('.faq-section-{{ section.id }} [data-faq-toggle]');

  toggles.forEach(function(toggle) {
    // Remove any existing event listeners
    toggle.replaceWith(toggle.cloneNode(true));
  });

  // Re-select toggles after cloning
  const newToggles = document.querySelectorAll('.faq-section-{{ section.id }} [data-faq-toggle]');

  newToggles.forEach(function(toggle) {
    toggle.addEventListener('click', function() {
      const answer = this.nextElementSibling;
      const isOpen = this.getAttribute('aria-expanded') === 'true';

      // Close all other FAQ items in this section
      newToggles.forEach(function(otherToggle) {
        const otherAnswer = otherToggle.nextElementSibling;
        otherToggle.setAttribute('aria-expanded', 'false');
        otherAnswer.classList.remove('open');
      });

      // Toggle current FAQ item
      if (!isOpen) {
        this.setAttribute('aria-expanded', 'true');
        answer.classList.add('open');
      }
    });

    // Keyboard accessibility
    toggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        this.click();
      }
    });
  });
}
{% endjavascript %}