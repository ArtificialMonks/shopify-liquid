{%- comment -%}
  FAQ Accordion Section

  Accessible collapsible FAQ section with proper ARIA attributes,
  keyboard navigation, and smooth animations.
{%- endcomment -%}

{%- liquid
  # Generate unique ID for CSS scoping
  assign unique = section.id | replace: '_', '' | downcase
-%}

{%- comment -%} CSS Scoping and Styles {%- endcomment -%}
{% style %}
  .faq-accordion-{{ unique }} {
    background: {{ section.settings.background_color | default: '#ffffff' }};
    padding: {{ section.settings.padding_top | default: 60 }}px 0 {{ section.settings.padding_bottom | default: 60 }}px;
    contain: layout style;
  }

  .faq-accordion-{{ unique }}__container {
    max-width: {{ section.settings.container_width | default: 800 }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .faq-accordion-{{ unique }}__header {
    text-align: {{ section.settings.text_alignment | default: 'center' }};
    margin-bottom: {{ section.settings.header_margin | default: 50 }}px;
  }

  .faq-accordion-{{ unique }}__title {
    font-size: {{ section.settings.title_size | default: 36 }}px;
    font-weight: {{ section.settings.title_weight | default: 700 }};
    color: {{ section.settings.title_color | default: '#333333' }};
    margin: 0 0 {{ section.settings.title_margin | default: 16 }}px 0;
    line-height: 1.2;
  }

  .faq-accordion-{{ unique }}__description {
    font-size: {{ section.settings.description_size | default: 18 }}px;
    color: {{ section.settings.description_color | default: '#666666' }};
    line-height: 1.6;
    margin: 0;
  }

  .faq-accordion-{{ unique }}__list {
    display: flex;
    flex-direction: column;
    gap: {{ section.settings.item_spacing | default: 16 }}px;
  }

  .faq-accordion-{{ unique }}__item {
    background: {{ section.settings.item_background | default: '#f8f9fa' }};
    border: {{ section.settings.item_border_width | default: 1 }}px solid {{ section.settings.item_border_color | default: '#e5e5e5' }};
    border-radius: {{ section.settings.item_radius | default: 8 }}px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .faq-accordion-{{ unique }}__item:hover {
    border-color: {{ section.settings.item_hover_border | default: '#007cba' }};
    box-shadow: 0 4px 12px rgba(0, 124, 186, 0.1);
  }

  .faq-accordion-{{ unique }}__button {
    width: 100%;
    background: none;
    border: none;
    padding: {{ section.settings.button_padding | default: '20px 24px' }};
    text-align: left;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: {{ section.settings.question_size | default: 18 }}px;
    font-weight: {{ section.settings.question_weight | default: 600 }};
    color: {{ section.settings.question_color | default: '#333333' }};
    line-height: 1.4;
    transition: color 0.3s ease;
    min-height: 44px;
  }

  .faq-accordion-{{ unique }}__button:hover {
    color: {{ section.settings.question_hover_color | default: '#007cba' }};
  }

  .faq-accordion-{{ unique }}__button:focus {
    outline: 2px solid {{ section.settings.focus_color | default: '#007cba' }};
    outline-offset: -2px;
  }

  .faq-accordion-{{ unique }}__button[aria-expanded="true"] {
    color: {{ section.settings.question_active_color | default: '#007cba' }};
  }

  .faq-accordion-{{ unique }}__icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
    margin-left: 16px;
    transition: transform 0.3s ease;
    color: {{ section.settings.icon_color | default: '#666666' }};
  }

  .faq-accordion-{{ unique }}__button[aria-expanded="true"] .faq-accordion-{{ unique }}__icon {
    transform: rotate(180deg);
    color: {{ section.settings.icon_active_color | default: '#007cba' }};
  }

  .faq-accordion-{{ unique }}__content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
  }

  .faq-accordion-{{ unique }}__content[aria-hidden="false"] {
    max-height: 500px;
    padding: 0 {{ section.settings.answer_padding_horizontal | default: 24 }}px {{ section.settings.answer_padding_bottom | default: 24 }}px;
  }

  .faq-accordion-{{ unique }}__answer {
    font-size: {{ section.settings.answer_size | default: 16 }}px;
    color: {{ section.settings.answer_color | default: '#555555' }};
    line-height: 1.6;
    margin: 0;
  }

  .faq-accordion-{{ unique }}__answer p {
    margin: 0 0 1em 0;
  }

  .faq-accordion-{{ unique }}__answer p:last-child {
    margin-bottom: 0;
  }

  .faq-accordion-{{ unique }}__answer a {
    color: {{ section.settings.link_color | default: '#007cba' }};
    text-decoration: underline;
  }

  .faq-accordion-{{ unique }}__answer a:hover {
    color: {{ section.settings.link_hover_color | default: '#005a9e' }};
  }

  /* Mobile Responsive */
  @media screen and (max-width: 749px) {
    .faq-accordion-{{ unique }} {
      padding: {{ section.settings.padding_top_mobile | default: 40 }}px 0 {{ section.settings.padding_bottom_mobile | default: 40 }}px;
    }

    .faq-accordion-{{ unique }}__container {
      padding: 0 16px;
    }

    .faq-accordion-{{ unique }}__title {
      font-size: {{ section.settings.title_size_mobile | default: 28 }}px;
    }

    .faq-accordion-{{ unique }}__description {
      font-size: {{ section.settings.description_size_mobile | default: 16 }}px;
    }

    .faq-accordion-{{ unique }}__button {
      padding: {{ section.settings.button_padding_mobile | default: '16px 20px' }};
      font-size: {{ section.settings.question_size_mobile | default: 16 }}px;
    }

    .faq-accordion-{{ unique }}__content[aria-hidden="false"] {
      padding: 0 {{ section.settings.answer_padding_horizontal_mobile | default: 20 }}px {{ section.settings.answer_padding_bottom_mobile | default: 20 }}px;
    }

    .faq-accordion-{{ unique }}__answer {
      font-size: {{ section.settings.answer_size_mobile | default: 14 }}px;
    }

    .faq-accordion-{{ unique }}__header {
      margin-bottom: {{ section.settings.header_margin_mobile | default: 30 }}px;
    }

    .faq-accordion-{{ unique }}__list {
      gap: {{ section.settings.item_spacing_mobile | default: 12 }}px;
    }
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .faq-accordion-{{ unique }}__item {
      transition: none;
    }

    .faq-accordion-{{ unique }}__icon {
      transition: none;
    }

    .faq-accordion-{{ unique }}__content {
      transition: none;
    }

    .faq-accordion-{{ unique }}__button {
      transition: none;
    }
  }
{% endstyle %}

{%- comment -%} JavaScript for Accordion Functionality {%- endcomment -%}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const accordionButtons = document.querySelectorAll('.faq-accordion-{{ unique }}__button');

    accordionButtons.forEach(button => {
      button.addEventListener('click', function() {
        const content = this.nextElementSibling;
        const isExpanded = this.getAttribute('aria-expanded') === 'true';

        // Close all other accordion items if single_open is enabled
        {% if section.settings.single_open %}
        accordionButtons.forEach(otherButton => {
          if (otherButton !== this) {
            otherButton.setAttribute('aria-expanded', 'false');
            otherButton.nextElementSibling.setAttribute('aria-hidden', 'true');
          }
        });
        {% endif %}

        // Toggle current accordion item
        this.setAttribute('aria-expanded', !isExpanded);
        content.setAttribute('aria-hidden', isExpanded);
      });

      // Handle keyboard navigation
      button.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.click();
        }
      });
    });
  });
</script>

{%- comment -%} HTML Structure {%- endcomment -%}
<section
  class="faq-accordion-{{ unique }}"
  aria-labelledby="faq-heading-{{ unique }}"
>
  <div class="faq-accordion-{{ unique }}__container">
    {%- if section.settings.title != blank or section.settings.description != blank -%}
      <div class="faq-accordion-{{ unique }}__header">
        {%- if section.settings.title != blank -%}
          <h2 class="faq-accordion-{{ unique }}__title" id="faq-heading-{{ unique }}">
            {{ section.settings.title | escape }}
          </h2>
        {%- endif -%}

        {%- if section.settings.description != blank -%}
          <div class="faq-accordion-{{ unique }}__description">
            {{ section.settings.description }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="faq-accordion-{{ unique }}__list">
        {%- for block in section.blocks -%}
          {%- if block.type == 'faq_item' -%}
            <div class="faq-accordion-{{ unique }}__item" {{ block.shopify_attributes }}>
              <button
                class="faq-accordion-{{ unique }}__button"
                aria-expanded="{% if forloop.first and section.settings.first_open %}true{% else %}false{% endif %}"
                aria-controls="faq-content-{{ unique }}-{{ forloop.index }}"
                id="faq-button-{{ unique }}-{{ forloop.index }}"
              >
                <span>{{ block.settings.question | escape }}</span>
                <svg
                  class="faq-accordion-{{ unique }}__icon"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  aria-hidden="true"
                >
                  <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
              </button>

              <div
                class="faq-accordion-{{ unique }}__content"
                id="faq-content-{{ unique }}-{{ forloop.index }}"
                aria-labelledby="faq-button-{{ unique }}-{{ forloop.index }}"
                aria-hidden="{% if forloop.first and section.settings.first_open %}false{% else %}true{% endif %}"
              >
                <div class="faq-accordion-{{ unique }}__answer">
                  {{ block.settings.answer }}
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- else -%}
      <div class="faq-accordion-{{ unique }}__empty">
        <p>{{ 'sections.faq.empty' | t }}</p>
      </div>
    {%- endif -%}
  </div>
</section>

{%- comment -%} Schema Configuration {%- endcomment -%}
{% schema %}
{
  "name": "FAQ Accordion",
  "tag": "section",
  "class": "faq-accordion-section",
  "settings": [
    {
      "type": "header",
      "content": "Content Settings"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Accordion Behavior"
    },
    {
      "type": "checkbox",
      "id": "single_open",
      "label": "Allow Only One Open at a Time",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "first_open",
      "label": "Open First Item by Default",
      "default": false
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "range",
      "id": "container_width",
      "label": "Container Width",
      "min": 600,
      "max": 1000,
      "step": 50,
      "unit": "px",
      "default": 800
    },
    {
      "type": "range",
      "id": "item_spacing",
      "label": "Item Spacing (Desktop)",
      "min": 8,
      "max": 32,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "item_spacing_mobile",
      "label": "Item Spacing (Mobile)",
      "min": 6,
      "max": 24,
      "step": 2,
      "unit": "px",
      "default": 12
    },
    {
      "type": "header",
      "content": "Item Styling"
    },
    {
      "type": "color",
      "id": "item_background",
      "label": "Item Background",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "item_border_color",
      "label": "Item Border Color",
      "default": "#e5e5e5"
    },
    {
      "type": "color",
      "id": "item_hover_border",
      "label": "Item Hover Border Color",
      "default": "#007cba"
    },
    {
      "type": "range",
      "id": "item_radius",
      "label": "Item Border Radius",
      "min": 0,
      "max": 16,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "question_color",
      "label": "Question Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "question_hover_color",
      "label": "Question Hover Color",
      "default": "#007cba"
    },
    {
      "type": "color",
      "id": "question_active_color",
      "label": "Question Active Color",
      "default": "#007cba"
    },
    {
      "type": "color",
      "id": "answer_color",
      "label": "Answer Color",
      "default": "#555555"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link Color",
      "default": "#007cba"
    },
    {
      "type": "color",
      "id": "link_hover_color",
      "label": "Link Hover Color",
      "default": "#005a9e"
    },
    {
      "type": "header",
      "content": "Font Sizes"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title Size (Desktop)",
      "min": 24,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 36
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Title Size (Mobile)",
      "min": 20,
      "max": 36,
      "step": 4,
      "unit": "px",
      "default": 28
    },
    {
      "type": "range",
      "id": "question_size",
      "label": "Question Size (Desktop)",
      "min": 14,
      "max": 24,
      "step": 2,
      "unit": "px",
      "default": 18
    },
    {
      "type": "range",
      "id": "question_size_mobile",
      "label": "Question Size (Mobile)",
      "min": 14,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "answer_size",
      "label": "Answer Size (Desktop)",
      "min": 14,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "answer_size_mobile",
      "label": "Answer Size (Mobile)",
      "min": 12,
      "max": 18,
      "step": 2,
      "unit": "px",
      "default": 14
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "icon_active_color",
      "label": "Icon Active Color",
      "default": "#007cba"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding (Desktop)",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding (Desktop)",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Top Padding (Mobile)",
      "min": 0,
      "max": 80,
      "step": 10,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Bottom Padding (Mobile)",
      "min": 0,
      "max": 80,
      "step": 10,
      "unit": "px",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>We offer a 30-day return policy for all unused items in their original packaging.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Accordion",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We offer a 30-day return policy for all unused items in their original packaging.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "<p>Standard shipping takes 3-5 business days. Express shipping options are available at checkout.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Do you offer international shipping?",
            "answer": "<p>Yes, we ship to over 50 countries worldwide. Shipping costs and delivery times vary by location.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}