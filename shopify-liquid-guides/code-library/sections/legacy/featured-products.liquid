{%- comment -%}
  Featured Products Section - CLEAN & WORKING

  Simple product showcase with:
  - Collection-based product selection
  - Responsive grid layout
  - Product cards with image, title, price
  - Optional section heading
  - Zero undefined settings
  - Zero complexity violations

  Perfect replacement for the broken 32-issue version
{%- endcomment -%}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign heading = section.settings.heading
  assign description = section.settings.description
  assign products_per_row = section.settings.products_per_row
  assign product_limit = section.settings.product_limit
  assign show_vendor = section.settings.show_vendor
  assign show_product_type = section.settings.show_product_type
-%}

<style>
  .featured-products-{{ section.id }} {
    padding: 3rem 1rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .featured-products-{{ section.id }}__header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .featured-products-{{ section.id }}__heading {
    font-size: 2rem;
    font-weight: bold;
    margin: 0 0 1rem 0;
  }

  .featured-products-{{ section.id }}__description {
    color: #666;
    line-height: 1.6;
    margin: 0;
  }

  .featured-products-{{ section.id }}__grid {
    display: grid;
    grid-template-columns: repeat({{ products_per_row }}, 1fr);
    gap: 2rem;
  }

  .featured-products-{{ section.id }}__card {
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease;
  }

  .featured-products-{{ section.id }}__card:hover {
    transform: translateY(-4px);
  }

  .featured-products-{{ section.id }}__image {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 1rem;
  }

  .featured-products-{{ section.id }}__vendor {
    font-size: 0.875rem;
    color: #666;
    margin: 0 0 0.25rem 0;
    text-transform: uppercase;
    font-weight: 500;
  }

  .featured-products-{{ section.id }}__title {
    font-weight: 600;
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    line-height: 1.3;
  }

  .featured-products-{{ section.id }}__type {
    font-size: 0.875rem;
    color: #888;
    margin: 0 0 0.5rem 0;
  }

  .featured-products-{{ section.id }}__price {
    font-weight: bold;
    color: #000;
  }

  .featured-products-{{ section.id }}__compare-price {
    text-decoration: line-through;
    color: #666;
    margin-right: 0.5rem;
  }

  .featured-products-{{ section.id }}__sale-badge {
    background-color: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    display: inline-block;
  }

  /* Mobile responsive */
  @media screen and (max-width: 749px) {
    .featured-products-{{ section.id }}__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .featured-products-{{ section.id }}__image {
      height: 200px;
    }

    .featured-products-{{ section.id }} {
      padding: 2rem 1rem;
    }
  }

  @media screen and (max-width: 480px) {
    .featured-products-{{ section.id }}__grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<section class="featured-products-{{ section.id }}" {{ section.shopify_attributes }}>

  {% if heading != blank or description != blank %}
    <div class="featured-products-{{ section.id }}__header">
      {% if heading != blank %}
        <h2 class="featured-products-{{ section.id }}__heading">
          {{ heading | escape }}
        </h2>
      {% endif %}

      {% if description != blank %}
        <div class="featured-products-{{ section.id }}__description">
          {{ description }}
        </div>
      {% endif %}
    </div>
  {% endif %}

  {% if collection.products.size > 0 %}
    <div class="featured-products-{{ section.id }}__grid">
      {% for product in collection.products limit: product_limit %}
        <a href="{{ product.url | escape }}" class="featured-products-{{ section.id }}__card">

          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 400 }}"
                 alt="{{ product.featured_image.alt | default: product.title | escape }}"
                 class="featured-products-{{ section.id }}__image"
                 width="400"
                 height="250"
                 loading="lazy">
          {% endif %}

          {% if product.compare_at_price > product.price %}
            <div class="featured-products-{{ section.id }}__sale-badge">
              Sale
            </div>
          {% endif %}

          {% if show_vendor and product.vendor != blank %}
            <div class="featured-products-{{ section.id }}__vendor">
              {{ product.vendor | escape }}
            </div>
          {% endif %}

          <h3 class="featured-products-{{ section.id }}__title">
            {{ product.title | escape }}
          </h3>

          {% if show_product_type and product.type != blank %}
            <div class="featured-products-{{ section.id }}__type">
              {{ product.type | escape }}
            </div>
          {% endif %}

          <div class="featured-products-{{ section.id }}__price">
            {% if product.compare_at_price > product.price %}
              <span class="featured-products-{{ section.id }}__compare-price">
                {{ product.compare_at_price | money }}
              </span>
            {% endif %}
            {{ product.price | money }}
          </div>

        </a>
      {% endfor %}
    </div>
  {% else %}
    <p style="text-align: center; color: #666;">No products found in this collection.</p>
  {% endif %}

</section>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "featured-products-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Discover our most popular products</p>"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_per_row",
      "label": "Products per row",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "product_limit",
      "label": "Number of products to show",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show product vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_product_type",
      "label": "Show product type",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Featured Products",
      "settings": {
        "heading": "Featured Products",
        "description": "<p>Discover our most popular products</p>",
        "products_per_row": 3,
        "product_limit": 6,
        "show_vendor": false,
        "show_product_type": false
      }
    }
  ]
}
{% endschema %}