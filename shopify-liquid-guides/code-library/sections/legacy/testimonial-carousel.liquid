{%- comment -%}
  Testimonial Carousel - CLEAN & WORKING

  Simple testimonial display with:
  - Multiple testimonial blocks
  - Customer name, title, and quote
  - Star ratings
  - Responsive layout
  - Zero undefined settings
  - Zero complexity violations

  Perfect replacement for the broken 37-issue version
{%- endcomment -%}

{%- liquid
  assign heading = section.settings.heading
  assign description = section.settings.description
  assign text_alignment = section.settings.text_alignment
-%}

<style>
  .testimonials-{{ section.id }} {
    padding: 3rem 1rem;
    background-color: {{ section.settings.background_color | default: '#f8f8f8' }};
    text-align: {{ text_alignment | default: 'center' }};
  }

  .testimonials-{{ section.id }}__container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .testimonials-{{ section.id }}__header {
    margin-bottom: 3rem;
  }

  .testimonials-{{ section.id }}__heading {
    font-size: 2rem;
    font-weight: bold;
    margin: 0 0 1rem 0;
  }

  .testimonials-{{ section.id }}__description {
    color: #666;
    line-height: 1.6;
    margin: 0;
  }

  .testimonials-{{ section.id }}__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .testimonials-{{ section.id }}__item {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .testimonials-{{ section.id }}__stars {
    color: #ffc107;
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }

  .testimonials-{{ section.id }}__quote {
    font-style: italic;
    line-height: 1.6;
    margin: 0 0 1.5rem 0;
    font-size: 1.1rem;
  }

  .testimonials-{{ section.id }}__author {
    font-weight: bold;
    margin: 0 0 0.25rem 0;
  }

  .testimonials-{{ section.id }}__title {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
  }

  /* Mobile responsive */
  @media screen and (max-width: 749px) {
    .testimonials-{{ section.id }}__grid {
      grid-template-columns: 1fr;
    }

    .testimonials-{{ section.id }} {
      padding: 2rem 1rem;
    }

    .testimonials-{{ section.id }}__item {
      padding: 1.5rem;
    }
  }
</style>

<section class="testimonials-{{ section.id }}" {{ section.shopify_attributes }}>
  <div class="testimonials-{{ section.id }}__container">

    {% if heading != blank or description != blank %}
      <div class="testimonials-{{ section.id }}__header">
        {% if heading != blank %}
          <h2 class="testimonials-{{ section.id }}__heading">
            {{ heading | escape }}
          </h2>
        {% endif %}

        {% if description != blank %}
          <div class="testimonials-{{ section.id }}__description">
            {{ description }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <div class="testimonials-{{ section.id }}__grid">
        {% for block in section.blocks %}
          <div class="testimonials-{{ section.id }}__item" {{ block.shopify_attributes }}>

            {% if block.settings.rating > 0 %}
              <div class="testimonials-{{ section.id }}__stars">
                {% for i in (1..5) %}
                  {% if i <= block.settings.rating %}★{% else %}☆{% endif %}
                {% endfor %}
              </div>
            {% endif %}

            {% if block.settings.quote != blank %}
              <blockquote class="testimonials-{{ section.id }}__quote">
                "{{ block.settings.quote | escape }}"
              </blockquote>
            {% endif %}

            {% if block.settings.author != blank %}
              <div class="testimonials-{{ section.id }}__author">
                {{ block.settings.author | escape }}
              </div>
            {% endif %}

            {% if block.settings.title != blank %}
              <div class="testimonials-{{ section.id }}__title">
                {{ block.settings.title | escape }}
              </div>
            {% endif %}

          </div>
        {% endfor %}
      </div>
    {% endif %}

  </div>
</section>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "testimonials-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Don't just take our word for it</p>"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f8f8f8"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "This product exceeded my expectations! Great quality and fast shipping."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author name",
          "default": "Sarah Johnson"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Author title",
          "default": "Verified Customer"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "This product exceeded my expectations! Great quality and fast shipping.",
            "author": "Sarah Johnson",
            "title": "Verified Customer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "Amazing customer service and beautiful products. I'll definitely be back!",
            "author": "Mike Davis",
            "title": "Happy Customer",
            "rating": 5
          }
        }
      ]
    }
  ]
}
{% endschema %}