{% comment %}
  Product Showcase Card Snippet

  Parameters:
  - product: Product object
  - unique: Unique identifier for scoped styling
  - show_vendor: Boolean to show artist/brand
  - show_price: Boolean to show price
  - enable_quick_buy: Boolean to enable quick buy
  - aspect_ratio: Image aspect ratio
  - settings: Section settings
  - block: Block object (optional)
{% endcomment %}

{% liquid
  assign product_url = product.url
  assign featured_image = product.featured_image
  assign vendor_name = product.vendor
  assign price = product.price
  assign compare_price = product.compare_at_price
  assign available = product.available
  assign on_sale = product.compare_at_price > product.price
  assign custom_badge = block.settings.custom_badge | default: ''
  assign first_variant = product.selected_or_first_available_variant

%}

<article class="product-showcase-{{ unique }}__card"
         data-product-id="{{ product.id | escape }}"
         {% if block %}{{ block.shopify_attributes }}{% endif %}>

  <!-- Image container -->
  <div class="product-showcase-{{ unique }}__image-container">
    {% if featured_image %}
      <a href="{{ product_url }}" aria-label="{{ 'products.product.view_product' | t: title: product.title  | escape }}">
        <picture>
          <source media="(min-width: 990px)"
                  srcset="{{ featured_image | image_url: width: 600 }} 600w,
                          {{ featured_image | image_url: width: 800 }} 800w">
          <source media="(min-width: 750px)"
                  srcset="{{ featured_image | image_url: width: 400 }} 400w,
                          {{ featured_image | image_url: width: 600 }} 600w">
          <img src="{{ featured_image | image_url: width: 400 }}"
               srcset="{{ featured_image | image_url: width: 300 }} 300w,
                       {{ featured_image | image_url: width: 400 }} 400w"
               sizes="(min-width: 990px) calc(100vw / {{ settings.products_per_row | escape }}), (min-width: 750px) 50vw, 100vw"
               alt="{{ featured_image.alt | escape | default: product.title  | escape }}"
               class="product-showcase-{{ unique }}__image"
               loading="lazy"
               width="400"
               height="{{ 400 | divided_by: featured_image.aspect_ratio | round }}">
        </picture>
      </a>
    {% else %}
      <!-- Placeholder image -->
      <div class="product-showcase-{{ unique }}__image product-showcase-{{ unique }}__image--placeholder"
           style="background: {{ settings.image_placeholder_color | default: '#f5f5f5' }};">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 60px; height: 60px; opacity: 0.3; margin: auto;">
          <rect x="10" y="10" width="80" height="60" fill="none" stroke="currentColor" stroke-width="2"/>
          <circle cx="30" cy="30" r="5" fill="currentColor"/>
          <polyline points="35,45 50,30 80,60 80,70 20,70 20,50" fill="none" stroke="currentColor" stroke-width="2"/>
        </svg>
      </div>
    {% endif %}

    <!-- Product badges -->
    {% if custom_badge != blank %}
      <span class="product-showcase-{{ unique }}__badge">{{ custom_badge | escape }}</span>
    {% elsif on_sale %}
      <span class="product-showcase-{{ unique }}__badge">{{ 'products.product.sale' | t }}</span>
    {% elsif not available %}
      <span class="product-showcase-{{ unique }}__badge">{{ 'products.product.sold_out' | t }}</span>
    {% endif %}
  </div>

  <!-- Product content -->
  <div class="product-showcase-{{ unique }}__content">

    <!-- Vendor/Artist name -->
    {% if show_vendor and vendor_name != blank %}
      <div class="product-showcase-{{ unique }}__vendor">
        {{ vendor_name | escape }}
      </div>
    {% endif %}

    <!-- Product title -->
    <h3 class="product-showcase-{{ unique }}__title">
      <a href="{{ product_url }}"
         style="text-decoration: none; color: inherit;"
         aria-label="{{ 'products.product.view_product' | t: title: product.title  | escape }}">
        {{ product.title | escape }}
      </a>
    </h3>

    <!-- Product price -->
    {% if show_price %}
      <div class="product-showcase-{{ unique }}__price">
        {% if on_sale %}
          <span class="product-showcase-{{ unique }}__price--compare">
            {{ compare_price | money }}
          </span>
          <span class="product-showcase-{{ unique }}__price--sale">
            {{ price | money }}
          </span>
        {% else %}
          <span>{{ price | money }}</span>
        {% endif %}

        {% comment %} Price range for products with variants {% endcomment %}
        {% if product.price_varies %}
          <span style="font-size: 0.875rem; color: {{ settings.text_color | default: '#666666' }};">
            {{ 'products.product.price_from' | t }}
          </span>
        {% endif %}
      </div>
    {% endif %}

    <!-- Quick buy button -->
    {% if enable_quick_buy and available and block.settings.show_quick_buy != false %}
      {% if product.has_only_default_variant %}
        <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="product-form">
          <input type="hidden" name="id" value="{{ first_variant.id }}">
          <button type="submit"
                  class="product-showcase-{{ unique }}__quick-buy"
                  data-product-id="{{ product.id | escape }}"
                  data-variant-id="{{ first_variant.id }}"
                  aria-label="{{ 'products.product.add_to_cart' | t: title: product.title  | escape }}">
            {{ 'products.product.add_to_cart' | t }}
          </button>
        </form>
      {% else %}
        <a href="{{ product_url }}"
           class="product-showcase-{{ unique }}__quick-buy"
           aria-label="{{ 'products.product.choose_options' | t: title: product.title  | escape }}">
          {{ 'products.product.choose_options' | t }}
        </a>
      {% endif %}
    {% elsif not available %}
      <button class="product-showcase-{{ unique }}__quick-buy"
              disabled
              style="opacity: 0.5; cursor: not-allowed;">
        {{ 'products.product.sold_out' | t }}
      </button>
    {% endif %}

  </div>

  {% comment %} Additional product metadata for artistic items {% endcomment %}
  {% if product.metafields.custom %}
    <div class="product-showcase-{{ unique }}__metadata" style="display: none;">
      {% if product.metafields.custom.artist_name %}
        <meta itemprop="creator" content="{{ product.metafields.custom.artist_name.value | escape }}">
      {% endif %}
      {% if product.metafields.custom.art_medium %}
        <meta itemprop="material" content="{{ product.metafields.custom.art_medium.value | escape }}">
      {% endif %}
      {% if product.metafields.custom.scent_notes %}
        <meta itemprop="description" content="{{ product.metafields.custom.scent_notes.value | join: ', ' | escape }}">
      {% endif %}
    </div>
  {% endif %}

</article>

{% comment %} Structured data for product {% endcomment %}
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": {{ shop.url | append: product_url | json }}{% if featured_image %},
  "image": {{ featured_image | image_url: width: 800 | json }}{% endif %},
  "description": {{ product.description | strip_html | truncate: 300 | json }},
  "brand": {
    "@type": "Brand",
    "name": {{ vendor_name | default: shop.name | json }}
  },
  "offers": {
    "@type": "Offer",
    "price": {{ price | divided_by: 100.0 | json }},
    "priceCurrency": {{ cart.currency.iso_code | json }},
    "availability": "https://schema.org/{% if available %}InStock{% else %}OutOfStock{% endif %}",
    "url": {{ shop.url | append: product_url | json }}
  }{% if product.metafields.custom.artist_name %},
  "creator": {
    "@type": "Person",
    "name": {{ product.metafields.custom.artist_name.value | json }}
  }{% endif %}
}
</script>