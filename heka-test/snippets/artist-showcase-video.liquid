{%- comment -%}
  Artist Showcase Video - Advanced Video Integration

  Usage: {% render 'artist-showcase-video', block: block, unique: unique %}

  Supports:
  - Uploaded video files
  - YouTube and Vimeo embeds
  - Custom embed codes
  - Video controls and autoplay
  - Responsive video containers
{%- endcomment -%}

{%- liquid
  assign video_type = block.settings.video_type | default: 'upload'
  assign video_file = block.settings.video_file
  assign video_url = block.settings.video_url
  assign video_embed_code = block.settings.video_embed_code
  assign video_poster = block.settings.video_poster
  assign video_autoplay = block.settings.video_autoplay | default: false
  assign video_loop = block.settings.video_loop | default: true
  assign video_controls = block.settings.video_controls | default: true

  assign video_id = 'video-' | append: unique | append: '-' | append: block.id

  # Extract video ID from URLs
  assign youtube_id = ''
  assign vimeo_id = ''

  if video_type == 'youtube' and video_url != blank
    if video_url contains 'youtube.com/watch?v='
      assign youtube_id = video_url | split: 'watch?v=' | last | split: '&' | first
    elsif video_url contains 'youtu.be/'
      assign youtube_id = video_url | split: 'youtu.be/' | last | split: '?' | first
    elsif video_url contains 'youtube.com/embed/'
      assign youtube_id = video_url | split: 'embed/' | last | split: '?' | first
    endif
  endif

  if video_type == 'vimeo' and video_url != blank
    if video_url contains 'vimeo.com/'
      assign vimeo_id = video_url | split: 'vimeo.com/' | last | split: '?' | first
    endif
  endif
-%}

<div
  class="artist-showcase__video artist-showcase__video--{{ video_type }}"
  id="{{ video_id }}"
  data-video-type="{{ video_type }}"
  data-video-autoplay="{{ video_autoplay }}"
  data-video-controls="{{ video_controls }}"
>

  {%- case video_type -%}
    {%- when 'upload' -%}
      {%- if video_file != blank -%}
        <div class="artist-showcase__video-container artist-showcase__video-container--native">
          <video
            class="artist-showcase__video-element"
            {% if video_poster != blank %}poster="{{ video_poster | image_url: width: 800 }}"{% endif %}
            {% if video_autoplay %}autoplay muted{% endif %}
            {% if video_loop %}loop{% endif %}
            {% if video_controls %}controls{% endif %}
            preload="metadata"
            playsinline
            aria-label="{% if block.settings.title != blank %}{{ block.settings.title | escape }}{% else %}Video content{% endif %}"
          >
            <source src="{{ video_file | file_url }}" type="video/mp4">
            <p>Your browser doesn't support HTML5 video. <a href="{{ video_file | file_url }}">Download the video</a>.</p>
          </video>

          {%- comment -%} Custom Play Button for Non-Autoplay Videos {%- endcomment -%}
          {%- unless video_autoplay -%}
            <button class="artist-showcase__video-play-button" aria-label="Play video">
              <svg class="artist-showcase__video-play-icon" width="72" height="72" viewBox="0 0 72 72" fill="none" aria-hidden="true">
                <circle cx="36" cy="36" r="36" fill="rgba(0,0,0,0.8)"/>
                <path d="M30 24L48 36L30 48V24Z" fill="white"/>
              </svg>
            </button>
          {%- endunless -%}
        </div>
      {%- endif -%}

    {%- when 'youtube' -%}
      {%- if youtube_id != blank -%}
        <div class="artist-showcase__video-container artist-showcase__video-container--youtube">
          <iframe
            class="artist-showcase__video-iframe"
            src="https://www.youtube.com/embed/{{ youtube_id }}?{% if video_autoplay %}autoplay=1&mute=1&{% endif %}{% if video_loop %}loop=1&playlist={{ youtube_id }}&{% endif %}{% unless video_controls %}controls=0&{% endunless %}rel=0&modestbranding=1"
            title="{% if block.settings.title != blank %}{{ block.settings.title | escape }}{% else %}YouTube video{% endif %}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            loading="lazy"
          ></iframe>

          {%- comment -%} Custom Thumbnail for YouTube {%- endcomment -%}
          {%- if video_poster != blank -%}
            <div class="artist-showcase__video-thumbnail" data-youtube-id="{{ youtube_id }}">
              <img
                src="{{ video_poster | image_url: width: 800 }}"
                alt="{% if block.settings.title != blank %}{{ block.settings.title | escape }}{% else %}Video thumbnail{% endif %}"
                width="800"
                height="{{ 800 | divided_by: video_poster.aspect_ratio | round }}"
                loading="lazy"
                class="artist-showcase__video-thumbnail-image"
              >
              <button class="artist-showcase__video-play-button" aria-label="Play YouTube video">
                <svg class="artist-showcase__video-play-icon" width="72" height="72" viewBox="0 0 72 72" fill="none" aria-hidden="true">
                  <circle cx="36" cy="36" r="36" fill="rgba(255,0,0,0.8)"/>
                  <path d="M30 24L48 36L30 48V24Z" fill="white"/>
                </svg>
              </button>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}

    {%- when 'vimeo' -%}
      {%- if vimeo_id != blank -%}
        <div class="artist-showcase__video-container artist-showcase__video-container--vimeo">
          <iframe
            class="artist-showcase__video-iframe"
            src="https://player.vimeo.com/video/{{ vimeo_id }}?{% if video_autoplay %}autoplay=1&muted=1&{% endif %}{% if video_loop %}loop=1&{% endif %}{% unless video_controls %}controls=0&{% endunless %}title=0&byline=0&portrait=0"
            title="{% if block.settings.title != blank %}{{ block.settings.title | escape }}{% else %}Vimeo video{% endif %}"
            frameborder="0"
            allow="autoplay; fullscreen; picture-in-picture"
            allowfullscreen
            loading="lazy"
          ></iframe>

          {%- comment -%} Custom Thumbnail for Vimeo {%- endcomment -%}
          {%- if video_poster != blank -%}
            <div class="artist-showcase__video-thumbnail" data-vimeo-id="{{ vimeo_id }}">
              <img
                src="{{ video_poster | image_url: width: 800 }}"
                alt="{% if block.settings.title != blank %}{{ block.settings.title | escape }}{% else %}Video thumbnail{% endif %}"
                width="800"
                height="{{ 800 | divided_by: video_poster.aspect_ratio | round }}"
                loading="lazy"
                class="artist-showcase__video-thumbnail-image"
              >
              <button class="artist-showcase__video-play-button" aria-label="Play Vimeo video">
                <svg class="artist-showcase__video-play-icon" width="72" height="72" viewBox="0 0 72 72" fill="none" aria-hidden="true">
                  <circle cx="36" cy="36" r="36" fill="rgba(26,183,234,0.8)"/>
                  <path d="M30 24L48 36L30 48V24Z" fill="white"/>
                </svg>
              </button>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}

    {%- when 'embedded' -%}
      {%- if video_embed_code != blank -%}
        <div class="artist-showcase__video-container artist-showcase__video-container--custom">
          <div class="artist-showcase__video-embed">
            {{ video_embed_code }}
          </div>
        </div>
      {%- endif -%}

  {%- endcase -%}

  {%- comment -%} Video Meta Information {%- endcomment -%}
  {%- if block.settings.title != blank or block.settings.subtitle != blank -%}
    <div class="artist-showcase__video-meta">
      {%- if block.settings.title != blank -%}
        <h4 class="artist-showcase__video-title">{{ block.settings.title | escape }}</h4>
      {%- endif -%}
      {%- if block.settings.subtitle != blank -%}
        <p class="artist-showcase__video-subtitle">{{ block.settings.subtitle | escape }}</p>
      {%- endif -%}
    </div>
  {%- endif -%}

  {%- comment -%} Video Loading State {%- endcomment -%}
  <div class="artist-showcase__video-loading" style="display: none;">
    <div class="artist-showcase__video-loading-spinner">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
          <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
          <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
        </circle>
      </svg>
    </div>
    <p>Loading video...</p>
  </div>

</div>