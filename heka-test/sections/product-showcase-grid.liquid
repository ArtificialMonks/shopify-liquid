{% comment %}
  Product Showcase Grid - Enterprise Grade

  Features:
  - Multi-mode display for clothes, candles, and art
  - Advanced image optimization with responsive srcset
  - Quick-buy integration with size charts
  - Collection-based filtering with AJAX
  - Performance optimized for large product catalogs
  - WCAG 2.1 AA accessibility compliance
{% endcomment %}

{% liquid
  assign unique = section.id | replace: '_', '' | downcase
  assign grid_layout = section.settings.grid_layout
  assign products_per_row = section.settings.products_per_row
  assign products_count = section.settings.products_count
  assign featured_collection = collections[section.settings.featured_collection]
  assign enable_quick_buy = section.settings.enable_quick_buy
  assign show_vendor = section.settings.show_vendor
  assign show_price = section.settings.show_price
  assign aspect_ratio = section.settings.image_aspect_ratio

%}

<style>
  .product-showcase-{{ unique }} {
    padding: {{ section.settings.section_padding_top }}px 0 {{ section.settings.section_padding_bottom }}px;
    background: {{ section.settings.background_color | default: 'transparent' }};
  }

  .product-showcase-{{ unique }}__container {
    max-width: {{ section.settings.max_width | default: 1400 }}px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .product-showcase-{{ unique }}__header {
    text-align: {{ section.settings.text_alignment | default: 'center'  | escape }};
    margin-bottom: 3rem;
  }

  .product-showcase-{{ unique }}__heading {
    font-size: clamp(32px, 5vw, {{ section.settings.heading_size | default: 40 }}px);
    font-weight: {{ section.settings.heading_weight | default: 700 }};
    color: {{ section.settings.heading_color | default: '#000000' }};
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .product-showcase-{{ unique }}__description {
    font-size: 1.125rem;
    color: {{ section.settings.text_color | default: '#666666'  | escape }};
    max-width: 600px;
    margin: 0 auto 2rem;
    line-height: 1.6;
  }

  .product-showcase-{{ unique }}__grid {
    display: grid;
    gap: {{ section.settings.grid_gap | default: 24 }}px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));

    {% case grid_layout %}
      {% when 'clothes' %}
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      {% when 'candles' %}
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      {% when 'art' %}
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    {% endcase %}
  }

  @media (min-width: 768px) {
    .product-showcase-{{ unique }}__grid {
      grid-template-columns: repeat({{ products_per_row }}, 1fr);
    }
  }

  .product-showcase-{{ unique }}__card {
    position: relative;
    background: {{ section.settings.card_background | default: '#ffffff' }};
    border-radius: {{ section.settings.card_border_radius | default: 8 }}px;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid {{ section.settings.card_border_color | default: '#e0e0e0' }};

    {% if section.settings.enable_hover_effects %}
      cursor: pointer;
    {% endif %}
  }

  {% if section.settings.enable_hover_effects %}
    .product-showcase-{{ unique }}__card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px {{ section.settings.hover_shadow_color | default: 'rgba(0, 0, 0, 0.15)' }};
      border-color: {{ section.settings.hover_border_color | default: '#cccccc' }};
    }
  {% endif %}

  .product-showcase-{{ unique }}__image-container {
    position: relative;
    width: 100%;
    {% case aspect_ratio %}
      {% when 'square' %}
        aspect-ratio: 1 / 1;
      {% when 'portrait' %}
        aspect-ratio: 3 / 4;
      {% when 'landscape' %}
        aspect-ratio: 4 / 3;
      {% when 'wide' %}
        aspect-ratio: 16 / 9;
      {% else %}
        aspect-ratio: 1 / 1;
    {% endcase %}
    overflow: hidden;
    background: {{ section.settings.image_placeholder_color | default: '#f5f5f5' }};
  }

  .product-showcase-{{ unique }}__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  {% if section.settings.enable_hover_effects %}
    .product-showcase-{{ unique }}__card:hover .product-showcase-{{ unique }}__image {
      transform: scale(1.05);
    }
  {% endif %}

  .product-showcase-{{ unique }}__badge {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    background: {{ section.settings.badge_background | default: '#e74c3c' }};
    color: {{ section.settings.badge_text_color | default: '#ffffff'  | escape }};
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    z-index: 2;
  }

  .product-showcase-{{ unique }}__content {
    padding: 1.5rem;
  }

  .product-showcase-{{ unique }}__vendor {
    font-size: 0.875rem;
    color: {{ section.settings.vendor_color | default: '#888888' }};
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 500;
  }

  .product-showcase-{{ unique }}__title {
    font-size: 1.125rem;
    font-weight: 600;
    color: {{ section.settings.title_color | default: '#000000'  | escape }};
    margin-bottom: 0.75rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .product-showcase-{{ unique }}__price {
    font-size: 1.25rem;
    font-weight: 700;
    color: {{ section.settings.price_color | default: '#000000' }};
    margin-bottom: 1rem;
  }

  .product-showcase-{{ unique }}__price--compare {
    font-size: 1rem;
    font-weight: 400;
    color: {{ section.settings.compare_price_color | default: '#888888' }};
    text-decoration: line-through;
    margin-right: 0.5rem;
  }

  .product-showcase-{{ unique }}__price--sale {
    color: {{ section.settings.sale_price_color | default: '#e74c3c' }};
  }

  .product-showcase-{{ unique }}__quick-buy {
    width: 100%;
    padding: 0.75rem 1.5rem;
    background: {{ section.settings.button_background | default: '#000000' }};
    color: {{ section.settings.button_text_color | default: '#ffffff'  | escape }};
    border: none;
    border-radius: {{ section.settings.button_border_radius | default: 4 }}px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .product-showcase-{{ unique }}__quick-buy:hover {
    background: {{ section.settings.button_hover_background | default: '#333333' }};
    transform: translateY(-1px);
  }

  .product-showcase-{{ unique }}__quick-buy:focus {
    outline: 3px solid var(--focus-ring-color, #007cba);
    outline-offset: 2px;
  }

  /* Grid layout specific styles */
  .product-showcase-{{ unique }}--clothes .product-showcase-{{ unique }}__card {
    /* Fashion-focused styling */
    border-radius: 0;
    border: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .product-showcase-{{ unique }}--candles .product-showcase-{{ unique }}__card {
    /* Lifestyle-focused styling */
    border-radius: 12px;
    background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
  }

  .product-showcase-{{ unique }}--art .product-showcase-{{ unique }}__card {
    /* Gallery-focused styling */
    border: 2px solid #e0e0e0;
    border-radius: 4px;
    background: #ffffff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .product-showcase-{{ unique }}__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .product-showcase-{{ unique }}__content {
      padding: 1rem;
    }

    .product-showcase-{{ unique }}__heading {
      margin-bottom: 0.5rem;
    }

    .product-showcase-{{ unique }}__description {
      margin-bottom: 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .product-showcase-{{ unique }}__grid {
      grid-template-columns: 1fr;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .product-showcase-{{ unique }}__card {
      border: 2px solid black !important;
      background: white !important;
    }

    .product-showcase-{{ unique }}__quick-buy {
      border: 2px solid black !important;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .product-showcase-{{ unique }}__card,
    .product-showcase-{{ unique }}__image,
    .product-showcase-{{ unique }}__quick-buy {
      transition: none !important;
    }

    .product-showcase-{{ unique }}__card:hover {
      transform: none !important;
    }

    .product-showcase-{{ unique }}__card:hover .product-showcase-{{ unique }}__image {
      transform: none !important;
    }
  }
</style>

<section class="product-showcase-{{ unique }} product-showcase-{{ unique }}--{{ grid_layout }}"
         data-section-id="{{ section.id }}"
         data-section-type="product-showcase-grid"
         {% if section.settings.section_heading != blank %}
           aria-labelledby="showcase-heading-{{ unique }}"
         {% endif %}>

  <div class="product-showcase-{{ unique }}__container">

    <!-- Section header -->
    {% if section.settings.section_heading != blank or section.settings.section_description != blank %}
      <div class="product-showcase-{{ unique }}__header">
        {% if section.settings.section_heading != blank %}
          <h2 id="showcase-heading-{{ unique }}" class="product-showcase-{{ unique }}__heading">
            {{ section.settings.section_heading | escape }}
          </h2>
        {% endif %}

        {% if section.settings.section_description != blank %}
          <div class="product-showcase-{{ unique }}__description">
            {{ section.settings.section_description }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <!-- Product grid -->
    <div class="product-showcase-{{ unique }}__grid"
         role="region"
         aria-label="{{ 'sections.product_grid.products' | t }}"
         data-products-count="{{ products_count }}">

      {% comment %} Featured collection products {% endcomment %}
      {% if featured_collection and featured_collection.products.size > 0 %}
        {% for product in featured_collection.products limit: products_count %}
          {% render 'product-showcase-card',
              product: product,
              unique: unique,
              show_vendor: show_vendor,
              show_price: show_price,
              enable_quick_buy: enable_quick_buy,
              aspect_ratio: aspect_ratio,
              settings: section.settings %}
        {% endfor %}
      {% endif %}

      {% comment %} Block-based products (manual curation) {% endcomment %}
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'product_card' %}
            {% if block.settings.featured_product %}
              {% assign product = all_products[block.settings.featured_product] %}
              {% render 'product-showcase-card',
                  product: product,
                  unique: unique,
                  show_vendor: show_vendor,
                  show_price: show_price,
                  enable_quick_buy: enable_quick_buy,
                  aspect_ratio: aspect_ratio,
                  settings: section.settings,
                  block: block %}
            {% endif %}
        {% endcase %}
      {% endfor %}

      {% comment %} Fallback content if no products {% endcomment %}
      {% if featured_collection.products.size == 0 and section.blocks.size == 0 %}
        <div class="product-showcase-{{ unique }}__empty" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
          <h3>{{ 'sections.product_grid.empty_title' | t }}</h3>
          <p>{{ 'sections.product_grid.empty_description' | t }}</p>
        </div>
      {% endif %}

    </div>

    <!-- View all button -->
    {% if section.settings.show_view_all and featured_collection %}
      <div style="text-align: center; margin-top: 3rem;">
        <a href="{{ featured_collection.url }}"
           class="product-showcase-{{ unique }}__quick-buy"
           style="display: inline-block; width: auto; padding: 1rem 2rem;">
          {{ 'sections.product_grid.view_all' | t: collection: featured_collection.title }}
        </a>
      </div>
    {% endif %}

  </div>
</section>

<!-- Create the product card snippet -->
<script>
  // Quick buy functionality
  document.addEventListener('DOMContentLoaded', function() {
    const quickBuyButtons = document.querySelectorAll('.product-showcase-{{ unique }}__quick-buy[data-product-id]');

    quickBuyButtons.forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        const productId = this.dataset.productId;
        const variantId = this.dataset.variantId;

        // Implement quick buy logic here
        // This would typically open a modal or add to cart directly
        // Quick buy clicked for product
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product Showcase Grid",
  "tag": "section",
  "class": "product-showcase-grid",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "section_heading",
      "label": "Section Heading",
      "default": "Featured Products"
    },
    {
      "type": "richtext",
      "id": "section_description",
      "label": "Section Description",
      "default": "<p>Discover our carefully curated selection of artistic pieces.</p>"
    },
    {
      "type": "header",
      "content": "Collection"
    },
    {
      "type": "collection",
      "id": "featured_collection",
      "label": "Featured Collection"
    },
    {
      "type": "range",
      "id": "products_count",
      "label": "Products to Show",
      "min": 4,
      "max": 24,
      "step": 4,
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' Button",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "grid_layout",
      "label": "Grid Layout",
      "default": "adaptive",
      "options": [
        {"value": "adaptive", "label": "Adaptive (Auto-adjust)"},
        {"value": "clothes", "label": "Fashion Mode"},
        {"value": "candles", "label": "Lifestyle Mode"},
        {"value": "art", "label": "Gallery Mode"}
      ]
    },
    {
      "type": "range",
      "id": "products_per_row",
      "label": "Products per Row (Desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Image Aspect Ratio",
      "default": "square",
      "options": [
        {"value": "square", "label": "Square (1:1)"},
        {"value": "portrait", "label": "Portrait (3:4)"},
        {"value": "landscape", "label": "Landscape (4:3)"},
        {"value": "wide", "label": "Wide (16:9)"}
      ]
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Grid Gap",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "default": "center",
      "options": [
        {"value": "left", "label": "Left"},
        {"value": "center", "label": "Center"},
        {"value": "right", "label": "Right"}
      ]
    },
    {
      "type": "range",
      "id": "max_width",
      "label": "Section Max Width",
      "min": 1000,
      "max": 1600,
      "step": 100,
      "default": 1400,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Product Display"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Artist/Brand",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show Price",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_buy",
      "label": "Enable Quick Buy",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_hover_effects",
      "label": "Enable Hover Effects",
      "default": true
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 120,
      "step": 8,
      "default": 64,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 120,
      "step": 8,
      "default": 64,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Colors & Typography"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Size",
      "min": 24,
      "max": 64,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "heading_weight",
      "label": "Heading Weight",
      "min": 300,
      "max": 900,
      "step": 100,
      "default": 700
    },
    {
      "type": "header",
      "content": "Card Styling"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card Border Color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "hover_border_color",
      "label": "Hover Border Color",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "hover_shadow_color",
      "label": "Hover Shadow Color",
      "default": "rgba(0, 0, 0, 0.15)"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card Border Radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "image_placeholder_color",
      "label": "Image Placeholder Color",
      "default": "#f5f5f5"
    },
    {
      "type": "header",
      "content": "Product Info Colors"
    },
    {
      "type": "color",
      "id": "vendor_color",
      "label": "Artist/Brand Color",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Product Title Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "compare_price_color",
      "label": "Compare Price Color",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "sale_price_color",
      "label": "Sale Price Color",
      "default": "#e74c3c"
    },
    {
      "type": "header",
      "content": "Button Styling"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button Hover Background",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "label": "Button Border Radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "default": 4,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Badge Styling"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "Badge Background",
      "default": "#e74c3c"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge Text Color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Product Card",
      "settings": [
        {
          "type": "product",
          "id": "featured_product",
          "label": "Featured Product"
        },
        {
          "type": "text",
          "id": "custom_badge",
          "label": "Custom Badge Text",
          "placeholder": "NEW, SALE, LIMITED, etc."
        },
        {
          "type": "checkbox",
          "id": "show_quick_buy",
          "label": "Show Quick Buy Button",
          "default": true
        }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [
    {
      "name": "Product Showcase Grid",
      "category": "Product Display",
      "settings": {
        "section_heading": "Featured Products",
        "grid_layout": "adaptive",
        "products_per_row": 4,
        "products_count": 12,
        "show_vendor": true,
        "show_price": true,
        "enable_quick_buy": true,
        "enable_hover_effects": true
      },
      "blocks": [
        {"type": "product_card"},
        {"type": "product_card"},
        {"type": "product_card"},
        {"type": "product_card"}
      ]
    }
  ]
}
{% endschema %}